(env
 (_
  (js_of_ocaml
   (compilation_mode separate))))

(executable
 (name test)
 (modules test)
 (enabled_if
  (and
   (<> %{profile} using-effects)
   (<> %{profile} wasm)
   (<> %{profile} wasm-effects)))
 (modes js)
 (libraries testlib))

(library
 (name testlib)
 (modules a b c d))

(test
 (name dump_sourcemap)
 (modules dump_sourcemap)
 (action (run %{test} %{dep:test.bc.js}))
 (enabled_if
  (and
   (<> %{profile} using-effects)
   (<> %{profile} wasm)
   (<> %{profile} wasm-effects)))
 (libraries js_of_ocaml-compiler))
